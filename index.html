<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>KW Explore Bond · Explore Property Group</title>
  <!-- Tailwind via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React + ReactDOM UMD -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <!-- Babel for in-browser JSX transform -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    html, body { background:#0b0f15; }
  </style>
</head>
<body class="min-h-screen text-white">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useMemo, useEffect } = React;

    // -------- Helpers --------
    const fmtZAR = (n) => new Intl.NumberFormat("en-ZA", { style:"currency", currency:"ZAR", maximumFractionDigits:0 }).format(isFinite(n)?n:0);

    function monthlyPayment({ principal, annualRatePct, years, paymentsPerYear=12 }){
      const r = annualRatePct > 0 ? (annualRatePct/100)/paymentsPerYear : 0;
      const n = years * paymentsPerYear;
      if (n <= 0) return 0;
      if (r === 0) return principal / n;
      return principal * r * Math.pow(1+r, n) / (Math.pow(1+r, n) - 1);
    }
    function buildAmortization({ principal, annualRatePct, years }){
      const r = (annualRatePct/100)/12;
      const n = years * 12;
      const pmt = monthlyPayment({ principal, annualRatePct, years });
      let bal = principal;
      const rows = [];
      for(let i=1;i<=n;i++){
        const interest = bal * r;
        const capital = Math.min(Math.max(0, pmt - interest), bal);
        bal = Math.max(0, bal - capital);
        rows.push({ month:i, payment:pmt, interest, principal:capital, balance:bal });
        if (bal <= 0) break;
      }
      return rows;
    }
    function buildAmortizationWithExtra({ principal, annualRatePct, years, extraMonthly=0, onceOffMonth=0, onceOffAmount=0 }){
      const r = (annualRatePct/100)/12;
      const base = monthlyPayment({ principal, annualRatePct, years });
      const rows = [];
      let bal = principal, m=0;
      const cap = years*12 + 600;
      while(bal > 0 && m < cap){
        m++;
        const opening = bal;
        const interest = opening * r;
        let pay = base + (extraMonthly||0);
        if (onceOffAmount>0 && m===onceOffMonth) pay += onceOffAmount;
        const principalPay = Math.min(Math.max(0, pay - interest), opening);
        bal = Math.max(0, opening - principalPay);
        rows.push({ month:m, payment:pay, interest, principal:principalPay, balance:bal });
      }
      return { rows, basePmt: base };
    }
    function exportAmortWithFormulasCSV(filename, principal, annualRatePct, years, extraMonthly){
      const r = (annualRatePct/100)/12;
      const base = monthlyPayment({ principal, annualRatePct, years });
      const pay = base + (extraMonthly||0);
      const maxRows = Math.min(600, years*12 + 360);
      const rows = [];
      rows.push(["Month","Opening","Interest","Payment","Extra","Principal","Closing"].join(","));
      rows.push([1, principal, `=B2*${r}`, `=IF(B2<=0,0,${pay})`, extraMonthly, `=IF(B2<=0,0,MIN(D2-C2,B2))`, `=IF(B2<=0,0,MAX(0,B2-G2))`].join(","));
      for(let i=3;i<2+maxRows;i++){
        const prev = i-1;
        rows.push([i-1, `=H${prev}`, `=B${i}*${r}`, `=IF(B${i}<=0,0,${pay})`, extraMonthly, `=IF(B${i}<=0,0,MIN(D${i}-C${i},B${i}))`, `=IF(B${i}<=0,0,MAX(0,B${i}-G${i}))`].join(","));
      }
      const blob = new Blob([rows.join("\n")], { type: "text/csv;charset=utf-8;" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url; a.download = filename; a.click();
      URL.revokeObjectURL(url);
    }

    // -------- SARS & Deeds --------
    const TD_2025APR = [
      { upTo: 1210000, base: 0, rateAbove: 0,    threshold: 0 },
      { upTo: 1663800, base: 0, rateAbove: 0.03, threshold: 1210000 },
      { upTo: 2329300, base: 13614, rateAbove: 0.06, threshold: 1663800 },
      { upTo: 2994800, base: 53544, rateAbove: 0.08, threshold: 2329300 },
      { upTo: 13310000, base: 106784, rateAbove: 0.11, threshold: 2994800 },
      { upTo: Infinity, base: 1241456, rateAbove: 0.13, threshold: 13310000 },
    ];
    const TD_2024MAR = [
      { upTo: 1100000, base: 0, rateAbove: 0,    threshold: 0 },
      { upTo: 1512500, base: 0, rateAbove: 0.03, threshold: 1100000 },
      { upTo: 2117500, base: 12375, rateAbove: 0.06, threshold: 1512500 },
      { upTo: 2722500, base: 48675, rateAbove: 0.08, threshold: 2117500 },
      { upTo: 12100000, base: 97075, rateAbove: 0.11, threshold: 2722500 },
      { upTo: Infinity, base: 1128600, rateAbove: 0.13, threshold: 12100000 },
    ];
    function transferDuty(amount, acquisitionDateISO){
      const d = new Date(acquisitionDateISO);
      const useApr2025 = !isNaN(d.valueOf()) && d >= new Date("2025-04-01T00:00:00");
      const table = useApr2025 ? TD_2025APR : TD_2024MAR;
      for(const band of table){
        if(amount <= band.upTo){
          const duty = band.base + Math.max(0, (amount - band.threshold)) * band.rateAbove;
          return Math.max(0, Math.round(duty));
        }
      }
      return 0;
    }
    const DEEDS_TRANSFER = [
      { upTo: 100000, fee: 50 }, { upTo: 200000, fee: 114 }, { upTo: 300000, fee: 727 },
      { upTo: 600000, fee: 906 }, { upTo: 800000, fee: 1275 }, { upTo: 1000000, fee: 1464 },
      { upTo: 2000000, fee: 1646 }, { upTo: 4000000, fee: 2281 }, { upTo: 6000000, fee: 2767 },
      { upTo: 8000000, fee: 3296 }, { upTo: 10000000, fee: 3853 }, { upTo: 15000000, fee: 4587 },
      { upTo: 20000000, fee: 5510 }, { upTo: Infinity, fee: 7340 },
    ];
    const DEEDS_BOND = [
      { upTo: 150000, fee: 561 }, { upTo: 300000, fee: 727 }, { upTo: 600000, fee: 906 },
      { upTo: 800000, fee: 1275 }, { upTo: 1000000, fee: 1464 }, { upTo: 2000000, fee: 1646 },
      { upTo: 4000000, fee: 2281 }, { upTo: 6000000, fee: 2767 }, { upTo: 8000000, fee: 3296 },
      { upTo: 10000000, fee: 3853 }, { upTo: 15000000, fee: 4587 }, { upTo: 20000000, fee: 5510 },
      { upTo: 30000000, fee: 6422 }, { upTo: Infinity, fee: 9176 },
    ];
    const deedsTransferFee = (price) => (DEEDS_TRANSFER.find(b => price <= b.upTo) || DEEDS_TRANSFER.at(-1)).fee;
    const deedsBondFee = (amt)   => (DEEDS_BOND.find(b => amt   <= b.upTo) || DEEDS_BOND.at(-1)).fee;

    // -------- UI --------
    const Card = ({ title, right, children }) => (
      <div className="bg-neutral-800 rounded-2xl shadow p-5 border border-neutral-700">
        {(title || right) && (
          <div className="flex items-center justify-between mb-4">
            <h3 className="text-xl font-semibold">{title}</h3>
            {right}
          </div>
        )}
        {children}
      </div>
    );

    function NumberInput({ label, value, onChange, allowDecimal=false, suffix }){
      const [text, setText] = useState(value ? String(value) : "");
      useEffect(()=>{
        const toNum = (s)=> Number((s||"").replace(/[^0-9\.]/g,"")) || 0;
        const current = toNum(text);
        const incoming = Number.isFinite(value) ? value : 0;
        if (current !== incoming) setText(incoming ? String(incoming) : "");
      }, [value]); // eslint-disable-line

      const handleChange = (raw) => {
        setText(raw);
        const cleaned = raw.replace(/[^0-9\.,]/g,"").replace(/,/g,".");
        if (cleaned === "") return;
        const num = Number(cleaned);
        if (Number.isFinite(num)) onChange(allowDecimal ? num : Math.floor(num));
      };
      const handleBlur = () => {
        const cleaned = text.replace(/[^0-9\.,]/g,"").replace(/,/g,".");
        const num = cleaned === "" ? 0 : Number(cleaned);
        const formatted = new Intl.NumberFormat("en-ZA",{ maximumFractionDigits: allowDecimal?2:0 }).format(num);
        setText(num===0 ? "" : formatted);
        onChange(allowDecimal ? num : Math.floor(num));
      };
      return (
        <label className="grid gap-1">
          <span className="text-sm text-neutral-300">{label}</span>
          <div className="flex rounded-xl border border-neutral-700 focus-within:ring-2 focus-within:ring-red-500/20 overflow-hidden">
            <input type="text" inputMode={allowDecimal ? "decimal":"numeric"} className="w-full p-3 outline-none bg-neutral-900 text-white"
              value={text} onChange={(e)=>handleChange(e.target.value)} onBlur={handleBlur} aria-label={label} />
            {suffix && <span className="px-3 py-2 text-neutral-300 self-center">{suffix}</span>}
          </div>
        </label>
      );
    }
    const PercentInput = (props) => <NumberInput {...props} allowDecimal suffix="%" />;
    const CurrencyInput = (props) => <NumberInput {...props} allowDecimal={false} suffix="R" />;

    const LOGO_SRC = "assets/KW Explore_White.png";
    const KW_RED = "#E31837";

    function App(){
      const [active, setActive] = useState("quick");
      const [persist, setPersist] = useState(false);

      // Bond inputs
      const [price, setPrice] = useState(0);
      const [deposit, setDeposit] = useState(0);
      const [rate, setRate] = useState(0);
      const [years, setYears] = useState(0);
      const [extraMonthly, setExtraMonthly] = useState(0);
      const [onceOffMonth, setOnceOffMonth] = useState(0);
      const [onceOffAmount, setOnceOffAmount] = useState(0);

      // Affordability (NCA)
      const [grossIncome, setGrossIncome] = useState(0);
      const [statDeductions, setStatDeductions] = useState(0);
      const [livingExpenses, setLivingExpenses] = useState(0);
      const [existingDebt, setExistingDebt] = useState(0);
      const [proposedInstallment, setProposedInstallment] = useState(0);
      const [bankCapPercent, setBankCapPercent] = useState(30);

      // Duty/fees
      const [acqDate, setAcqDate] = useState(new Date().toISOString().slice(0,10));
      const [includeVAT, setIncludeVAT] = useState(true);
      const vatRate = 0.15;
      const [initiationFee, setInitiationFee] = useState(6037);

      useEffect(()=>{
        if (!persist) return;
        const s = { active, price, deposit, rate, years };
        localStorage.setItem("mc-toolkit-v1", JSON.stringify(s));
      }, [persist, active, price, deposit, rate, years]);

      // Derived
      const loan = Math.max(0, price - deposit);
      const readyRepay = loan > 0 && rate > 0 && years > 0;
      const pmt = readyRepay ? monthlyPayment({ principal: loan, annualRatePct: rate, years }) : 0;
      const amort = useMemo(()=> readyRepay ? buildAmortization({ principal: loan, annualRatePct: rate, years }) : [], [readyRepay, loan, rate, years]);
      const totalInterest = amort.reduce((s,r)=> s + r.interest, 0);

      const extraScenario = useMemo(()=> readyRepay && (extraMonthly>0 || onceOffAmount>0)
        ? buildAmortizationWithExtra({ principal: loan, annualRatePct: rate, years, extraMonthly, onceOffMonth, onceOffAmount })
        : null, [readyRepay, loan, rate, years, extraMonthly, onceOffMonth, onceOffAmount]);
      const totalInterestExtra = extraScenario ? extraScenario.rows.reduce((s, r)=> s + r.interest, 0) : 0;
      const monthsOriginal = readyRepay ? years*12 : 0;
      const monthsNew = extraScenario ? extraScenario.rows.length : 0;
      const monthsSaved = extraScenario ? Math.max(0, monthsOriginal - monthsNew) : 0;
      const interestSaved = extraScenario ? Math.max(0, totalInterest - totalInterestExtra) : 0;

      // Duty & fees
      const readyPrice = price > 0;
      const duty = readyPrice ? transferDuty(price, acqDate) : 0;
      const deedsTransfer = readyPrice ? deedsTransferFee(price) : 0;
      const deedsBond = readyRepay ? deedsBondFee(loan) : 0;
      const vatOnFees = includeVAT ? Math.round((deedsTransfer + deedsBond + initiationFee) * vatRate) : 0;
      const totalUpfront = duty + deedsTransfer + deedsBond + initiationFee + vatOnFees;

      // NCA
      const G = Number(grossIncome)||0, S=Number(statDeductions)||0, L=Number(livingExpenses)||0, Dd=Number(existingDebt)||0, I=Number(proposedInstallment)||0;
      const capPct = Math.max(0, Number(bankCapPercent)||0);
      const DI = Math.max(0, G - S - L - Dd);
      const ncaMargin = DI - I;
      const thirtyCap = capPct > 0 ? (capPct/100) * G : Infinity;
      const maxInstallment = Math.min(DI, thirtyCap);
      const combinedMargin = maxInstallment - I;
      let pillText = "Borderline";
      let pillClass = "bg-amber-500/15 text-amber-200 border border-amber-400/40";
      if (G>0 && I>0){
        if (ncaMargin < 0) { pillText = "Fail (NCA)"; pillClass = "bg-red-500/15 text-red-200 border border-red-400/40"; }
        else if (capPct>0 && I > thirtyCap) { pillText = "Fail (bank cap)"; pillClass = "bg-red-500/15 text-red-200 border border-red-400/40"; }
        else { pillText = "Pass"; pillClass = "bg-emerald-500/15 text-emerald-200 border border-emerald-400/40"; }
      }

      return (
        <div className="min-h-screen bg-neutral-900 text-white">
          <header className="sticky top-0 z-20 text-white border-b" style={{ backgroundColor: KW_RED }}>
            <div className="max-w-6xl mx-auto px-4 py-3 flex items-center gap-3 justify-between">
              <div className="flex items-center gap-3">
                <img src={LOGO_SRC} alt="KW Explore" className="h-10 w-auto" />
                <div>
                  <div className="font-semibold leading-tight">KW Explore Bond <span className="text-xs font-normal ml-2">— This is just an indication. Please contact transferring attorney for accurate quote.</span></div>
                  <div className="text-xs text-white/80 -mt-0.5">Explore Property Group Bond Calculator</div>
                </div>
              </div>
              <div className="flex items-center gap-2">
                <button onClick={()=>window.print()} className="px-3 py-2 rounded-xl border border-white/20 hover:bg-white/10">Print</button>
                <label className="flex items-center gap-2 px-3 py-2 rounded-xl border border-white/20 cursor-pointer">
                  <input type="checkbox" checked={persist} onChange={(e)=>setPersist(e.target.checked)} />
                  <span className="text-sm">Auto-save</span>
                </label>
              </div>
            </div>
          </header>

          <main className="max-w-6xl mx-auto px-4 py-6 grid gap-6">
            <nav className="flex gap-2 overflow-x-auto whitespace-nowrap text-sm">
              {[
                {id:'quick',label:'Quick calc'},
                {id:'bond',label:'Bond repayment'},
                {id:'afford',label:'Affordability'},
                {id:'duty',label:'Transfer duty'},
                {id:'fees',label:'Deeds fees'}
              ].map(t=>(
                <button key={t.id} onClick={()=>setActive(t.id)}
                  className={`px-3 py-2 rounded-xl border border-neutral-700 ${active===t.id?'text-white':'bg-neutral-800 hover:bg-neutral-700 text-white'}`}
                  style={active===t.id ? {backgroundColor:KW_RED, borderColor:KW_RED}:{}}>
                  {t.label}
                </button>
              ))}
            </nav>

            {active==='quick' && (
              <div className="max-w-3xl mx-auto">
                <Card>
                  <div className="grid gap-4">
                    <CurrencyInput label="Purchase Price (R)" value={price} onChange={setPrice} />
                    <CurrencyInput label="Deposit (R)" value={deposit} onChange={setDeposit} />
                    <PercentInput label="Interest Rate (%)" value={rate} onChange={setRate} />
                    <NumberInput label="Term (Years)" value={years} onChange={setYears} />
                  </div>
                  <div className="mt-4 grid gap-2 text-sm">
                    <div>Estimated Monthly Repayment: <span className="font-semibold">{readyRepay?fmtZAR(pmt):'—'}</span></div>
                    <div>Total Repayments over {years||'—'} years: <span className="font-semibold">{readyRepay?fmtZAR(pmt*years*12):'—'}</span></div>
                    <div>Estimated Total Upfront Costs: <span className="font-semibold">{readyPrice?fmtZAR(totalUpfront):'—'}</span></div>
                  </div>
                </Card>
              </div>
            )}

            {active==='bond' && (
              <div className="grid md:grid-cols-5 gap-6">
                <div className="md:col-span-2 grid gap-6">
                  <Card title="Inputs">
                    <div className="grid gap-4">
                      <CurrencyInput label="Purchase price" value={price} onChange={setPrice} />
                      <CurrencyInput label="Deposit" value={deposit} onChange={setDeposit} />
                      <PercentInput label="Interest rate (annual)" value={rate} onChange={setRate} />
                      <NumberInput label="Term (years)" value={years} onChange={setYears} />
                      <CurrencyInput label="Extra monthly payment (optional)" value={extraMonthly} onChange={setExtraMonthly} />
                      <div className="grid grid-cols-2 gap-3">
                        <NumberInput label="Once-off extra: month #" value={onceOffMonth} onChange={setOnceOffMonth} />
                        <CurrencyInput label="Once-off extra: amount" value={onceOffAmount} onChange={setOnceOffAmount} />
                      </div>
                      <div className="text-xs text-neutral-400">Fixed rate, monthly compounding. Extra payments shorten the term and cut interest.</div>
                    </div>
                  </Card>

                  <Card title="Upfront costs (quick view)">
                    <div className="grid grid-cols-2 gap-3 text-sm">
                      <div className="text-neutral-300">Transfer duty</div><div className="text-right font-medium">{readyPrice?fmtZAR(duty):'—'}</div>
                      <div className="text-neutral-300">Deeds (transfer) fee</div><div className="text-right font-medium">{readyPrice?fmtZAR(deedsTransfer):'—'}</div>
                      <div className="text-neutral-300">Deeds (bond) fee</div><div className="text-right font-medium">{readyRepay?fmtZAR(deedsBond):'—'}</div>
                      <div className="text-neutral-300">Bank initiation</div><div className="text-right font-medium">{fmtZAR(initiationFee)}</div>
                      <div className="text-neutral-300">VAT on above {includeVAT?'(15%)':'(excluded)'}</div><div className="text-right font-medium">{readyPrice||readyRepay?fmtZAR(vatOnFees):'—'}</div>
                      <div className="col-span-2 h-px bg-gray-200/20 my-2"></div>
                      <div className="text-neutral-300">Estimated cash to close</div><div className="text-right font-semibold">{readyPrice||readyRepay?fmtZAR(totalUpfront):'—'}</div>
                    </div>
                  </Card>
                </div>

                <div className="md:col-span-3 grid gap-6">
                  <Card title="Monthly repayment" right={
                    <div className="flex gap-2">
                      <button className="px-3 py-2 rounded-lg border" onClick={()=>exportAmortWithFormulasCSV('amortization_formulas.csv', loan, rate, years, extraMonthly)}>Export to Excel (formulas)</button>
                    </div>
                  }>
                    <div className="grid sm:grid-cols-2 gap-6">
                      <div>
                        <div className="text-sm text-neutral-300">Loan amount</div>
                        <div className="text-2xl font-semibold">{readyRepay?fmtZAR(loan):'—'}</div>
                      </div>
                      <div>
                        <div className="text-sm text-neutral-300">Monthly installment</div>
                        <div className="text-2xl font-semibold">{readyRepay?fmtZAR(pmt):'—'}</div>
                      </div>
                      <div>
                        <div className="text-sm text-neutral-300">Total interest (life of loan)</div>
                        <div className="text-lg font-medium">{readyRepay?fmtZAR(totalInterest):'—'}</div>
                      </div>
                      <div>
                        <div className="text-sm text-neutral-300">Total paid (capital + interest)</div>
                        <div className="text-lg font-medium">{readyRepay?fmtZAR(totalInterest + loan):'—'}</div>
                      </div>
                    </div>
                  </Card>

                  <Card title="Amortization schedule">
                    <div className="max-h-80 overflow-auto rounded-lg border border-neutral-700">
                      <table className="min-w-full text-sm">
                        <thead className="sticky top-0 bg-neutral-800">
                          <tr>
                            <th className="text-left p-2">Month</th>
                            <th className="text-right p-2">Payment</th>
                            <th className="text-right p-2">Interest</th>
                            <th className="text-right p-2">Principal</th>
                            <th className="text-right p-2">Balance</th>
                          </tr>
                        </thead>
                        <tbody>
                          {amort.length===0 ? (
                            <tr><td className="p-3 text-center text-neutral-400" colSpan={5}>Enter price, deposit, interest and term to see the schedule.</td></tr>
                          ) : amort.map(r => (
                            <tr key={r.month} className="odd:bg-neutral-900 even:bg-neutral-800">
                              <td className="p-2">{r.month}</td>
                              <td className="p-2 text-right">{fmtZAR(r.payment)}</td>
                              <td className="p-2 text-right">{fmtZAR(r.interest)}</td>
                              <td className="p-2 text-right">{fmtZAR(r.principal)}</td>
                              <td className="p-2 text-right">{fmtZAR(r.balance)}</td>
                            </tr>
                          ))}
                        </tbody>
                      </table>
                    </div>
                  </Card>

                  {(extraMonthly>0 || onceOffAmount>0) && (
                    <Card title="Extra payment impact">
                      {extraScenario ? (
                        <div className="grid sm:grid-cols-2 gap-6">
                          <div>
                            <div className="text-sm text-neutral-300">New term (months)</div>
                            <div className="text-2xl font-semibold">{monthsNew}</div>
                          </div>
                          <div>
                            <div className="text-sm text-neutral-300">Months saved</div>
                            <div className="text-2xl font-semibold">{monthsSaved}</div>
                          </div>
                          <div>
                            <div className="text-sm text-neutral-300">Interest saved</div>
                            <div className="text-2xl font-semibold">{fmtZAR(interestSaved)}</div>
                          </div>
                        </div>
                      ) : (
                        <div className="text-neutral-400 text-sm">Enter base inputs to compute the extra-payment scenario.</div>
                      )}
                    </Card>
                  )}
                </div>
              </div>
            )}

            {active==='afford' && (
              <div className="grid md:grid-cols-2 gap-6">
                <Card title="Affordability · NCA (South Africa)">
                  <div className="grid gap-4">
                    <CurrencyInput label="Gross income (monthly)" value={grossIncome} onChange={setGrossIncome} />
                    <CurrencyInput label="Statutory deductions" value={statDeductions} onChange={setStatDeductions} />
                    <CurrencyInput label="Living expenses" value={livingExpenses} onChange={setLivingExpenses} />
                    <CurrencyInput label="Existing debt instalments" value={existingDebt} onChange={setExistingDebt} />
                    <CurrencyInput label="Proposed property instalment" value={proposedInstallment} onChange={setProposedInstallment} />
                    <NumberInput label="Bank rule cap (% of gross) — set 0 to ignore" value={bankCapPercent} onChange={setBankCapPercent} allowDecimal suffix="%" />
                    <div className="text-xs text-neutral-400">Discretionary income (Reg 23A) with optional bank cap (e.g. 30% of gross).</div>
                  </div>
                </Card>

                <Card title="Result">
                  {(G<=0 || I<=0) ? (
                    <div className="text-sm text-neutral-400">Enter gross income and proposed instalment to run the assessment.</div>
                  ) : (
                    <div className="grid gap-3">
                      <div className={`px-3 py-1 rounded-full w-max text-xs uppercase tracking-wider ${pillClass}`}>{pillText}</div>
                      <div className="grid gap-2">
                        <div className="flex justify-between text-sm bg-neutral-900 border border-neutral-700 rounded-xl p-2"><span className="text-neutral-300">Discretionary income (DI)</span><span>{fmtZAR(DI)}</span></div>
                        <div className="flex justify-between text-sm bg-neutral-900 border border-neutral-700 rounded-xl p-2"><span className="text-neutral-300">NCA margin (DI − new instalment)</span><span>{(ncaMargin>=0?'+':'') + fmtZAR(ncaMargin)}</span></div>
                        <div className="flex justify-between text-sm bg-neutral-900 border border-neutral-700 rounded-xl p-2"><span className="text-neutral-300">{capPct>0 ? ('Bank cap ('+capPct+'% of gross)') : 'Bank cap'}</span><span>{isFinite(thirtyCap)?fmtZAR(thirtyCap):'—'}</span></div>
                        <div className="flex justify-between text-sm bg-neutral-900 border border-neutral-700 rounded-xl p-2"><span className="text-neutral-300">Max instalment (combined rules)</span><span>{fmtZAR(maxInstallment)}</span></div>
                        <div className="flex justify-between text-sm bg-neutral-900 border border-neutral-700 rounded-xl p-2"><span className="text-neutral-300">Combined margin (max − new instalment)</span><span>{(combinedMargin>=0?'+':'') + fmtZAR(combinedMargin)}</span></div>
                      </div>
                      <div className="text-xs text-neutral-400">Guidance only — a full lender/NCR assessment still applies.</div>
                    </div>
                  )}
                </Card>
              </div>
            )}

            {active==='duty' && (
              <div className="grid md:grid-cols-2 gap-6">
                <Card title="Inputs">
                  <div className="grid gap-4">
                    <CurrencyInput label="Purchase price" value={price} onChange={setPrice} />
                    <label className="grid gap-1">
                      <span className="text-sm text-neutral-300">Acquisition date</span>
                      <input type="date" className="p-3 rounded-xl border border-neutral-700 bg-neutral-900 text-white" value={acqDate} onChange={(e)=>setAcqDate(e.target.value)} />
                    </label>
                    <label className="inline-flex items-center gap-2">
                      <input type="checkbox" checked={includeVAT} onChange={(e)=>setIncludeVAT(e.target.checked)} />
                      <span className="text-sm">Include VAT on fees (15%)</span>
                    </label>
                  </div>
                </Card>
                <Card title="Results">
                  <div className="grid gap-3">
                    <div className="flex justify-between text-sm"><span className="text-neutral-300">Transfer duty</span><span className="font-semibold">{readyPrice?fmtZAR(duty):'—'}</span></div>
                    <div className="text-xs text-neutral-400">Automatically applies SARS schedule 1 Apr 2025 when applicable.</div>
                  </div>
                </Card>
              </div>
            )}

            {active==='fees' && (
              <div className="grid md:grid-cols-2 gap-6">
                <Card title="Inputs">
                  <div className="grid gap-4">
                    <CurrencyInput label="Purchase price" value={price} onChange={setPrice} />
                    <CurrencyInput label="Bond amount" value={loan} onChange={()=>{}} />
                    <div className="text-xs text-neutral-400">Bond amount is derived from price minus deposit.</div>
                  </div>
                </Card>
                <Card title="Guideline costs (Aug 2025)">
                  <div className="grid gap-2 text-sm">
                    <div className="flex justify-between"><span className="text-neutral-300">Transfer costs (inc. duty)</span><span className="font-medium">{readyPrice?fmtZAR(duty + deedsTransfer):'—'}</span></div>
                    <div className="flex justify-between"><span className="text-neutral-300">Bond registration costs</span><span className="font-medium">{readyRepay?fmtZAR(deedsBond):'—'}</span></div>
                    <div className="flex justify-between"><span className="text-neutral-300">Bank initiation (editable)</span><span className="font-medium">{fmtZAR(initiationFee)}</span></div>
                    <div className="flex justify-between"><span className="text-neutral-300">Estimated cash to close</span><span className="font-semibold">{readyPrice||readyRepay?fmtZAR(totalUpfront):'—'}</span></div>
                  </div>
                  <div className="text-xs text-neutral-400 mt-2">Figures reflect Deeds Office levies (1 Apr 2025). Professional fees & disbursements vary.</div>
                </Card>
              </div>
            )}
          </main>

          <footer className="max-w-6xl mx-auto px-4 pb-10 text-xs text-neutral-400">
            <div>© {new Date().getFullYear()} Explore Property Group. Estimates only; no warranties. Check with your conveyancer and lender.</div>
          </footer>

          <style>{`@media print{ nav, header button { display:none; } main { padding-top: 0; } }`}</style>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<App/>);
  </script>
</body>
</html>